{
	"$schema": "../tmlanguage.json",
	
	"name": "GM",

	"scopeName": "source.gm",
	"patterns": [
		{
			"include": "#gmlang"
		}
	],

	"repository": {
		"gmlang": {
			"patterns": [
				{
					"comment": "first priority",
					"include": "#comments"
				},
				{
					"include": "#brackets"
				},
				{
					"include": "#invalids"
				},
				{
					"comment": "includes keywords",
					"include": "#constants"
				},
				{
					"include": "#variables"
				}
			]
		},
		"brackets": {
			"patterns": [
				{
					"include": "#round-brackets"
				},
				{
					"include": "#square-brackets"
				},
				{
					"include": "#curly-brackets"
				},
				{
					"include": "#lock-symbols"
				},
				{
					"comment": "the name is undetermined now",
					"include": "#locator"
				}
			]
		},
		"round-brackets": {
			"begin": "\\(",
			"beginCaptures": {
				"0": {
					"name": "punctuation.define.sequence.begin.gm"
				}
			},
			"end": "\\)",
			"endCaptures": {
				"0": {
					"name": "punctuation.define.sequence.end.gm"
				}
			},
			"name": "meta.structure.sequence.gm",
			"patterns": [
				{
					"include": "#gmlang"
				}
			]
		},
		"square-brackets": {
			"begin": "(?<!^|,)\\s*(\\[)",
			"beginCaptures": {
				"1": {
					"name": "punctuation.define.subscript.begin.gm"
				}
			},
			"end": "\\]",
			"endCaptures": {
				"0": {
					"name": "punctuation.define.subscript.end.gm"
				}
			},
			"name": "meta.structure.subscript.gm",
			"patterns": [
				{
					"include": "#gmlang"
				}
			]
		},
		"curly-brackets": {
			"begin": "\\{",
			"beginCaptures": {
				"0": {
					"name": "punctuation.define.set.begin.gm"
				}
			},
			"end": "\\}",
			"endCaptures": {
				"0": {
					"name": "punctuation.define.set.end.gm"
				}
			},
			"name": "meta.structure.set.gm",
			"patterns": [
				{
					"include": "#gmlang"
				},
				{
					"comment": "I don't know whether I will use this symbol later",
					"match": "\\|",
					"name": "punctuation.separator.gm"
				}
			]
		},
		"lock-symbols": {
			"comment": "I don't know whether I would use it later",
			"begin": "&",
			"beginCaptures": {
				"0": {
					"name": "punctuation.lock_symbol.begin.gm"
				}
			},
			"end": "&|(?:(?<!\\\\)\n)",
			"endCaptures": {
				"0": {
					"name": "punctuation.lock_symbol.end.gm"
				}
			},
			"patterns": [
				{
					"include": "#gmlang"
				}
			]
		},
		"locator": {
			"begin": "(@)\\b([^\\s,;:]+(?:\\.[^\\s,;:]+)*)(,)",
			"beginCaptures": {
				"1": {
					"name": "keyword.control.locator.gm"
				},
				"2": {
					"name": "markup.underline.link.gm"
				},
				"3": {
					"name": "punctuation.separator.gm"
				}
			},
			"end": "■",
			"endCaptures": {
				"0": {
					"name": "keyword.control.terminator.gm"
				}
			},
			"patterns": [
				{
					"include": "#gmlang"
				}
			]
		},
		"constants": {
			"patterns": [
				{
					"include": "#keywords"
				},
				{
					"include": "#numeric"
				},
				{
					"include": "#functions"
				},
				{
					"include": "#strings"
				},
				{
					"comment": "undetermined",
					"match": "([^\\s,:;(){}\\[\\]&.|∀∃!]+)\\s*(\\.)\\s*([^\\s,:;(){}\\[\\]&.|]+)",
					"captures": {
						"1": {
							"name": "constant.other.loaction.gm"
						},
						"2": {
							"name": "punctuation.package.gm"
						},
						"3": {
							"name": "constant.other.loaction.gm"
						}
					}
				},
				{
					"name": "constant.other.color.gm",
					"match": "#(?:(?:[0-9a-fA-F]{3}){1,2}|(?:[0-9a-fA-F]{4}){1,2})\\b"
				}
			]
		},
		"variables": {
			"begin": "([∀∃!])(?![:\\s.])",
			"beginCaptures": {
				"1": {
					"name": "keyword.quantifier.gm"
				}
			},
			"end": "(?<!\\s):",
			"endCaptures": {
				"0": {
					"name": "keyword.control.define.gm"
				}
			},
			"contentName": "variable.define.gm",
			"patterns": [
				{
					"include": "#gmlang"
				}
			]
		},
		"numeric": {
			"comment": "I may delete it later",
			"patterns": [
				{
					"name": "constant.numeric.gm",
					"match": "\\b(?!\\.)[0-9π]\\b(?!:)"
				},
				{
					"name": "constant.numeric.dec.gm",
					"match": "\\b[-+]?(?:[Dd][Ee][Cc]\\.)?[1-9][0-9]*(?:\\.(?:e|[0-9]+))?\\b(?!:)"
				},
				{
					"name": "constant.numeric.bin.gm",
					"match": "\\b[-+]?[Bb][Ii][Nn]\\.1[01]*(?:\\.(?:e|[01]+))?\\b"
				},
				{
					"name": "constant.numeric.oct.gm",
					"match": "\\b[-+]?[Oo][Cc][Tt]\\.[1-7][0-7]*(?:\\.(?:e|[0-7]+))?\\b"
				},
				{
					"name": "constant.numeric.hex.gm",
					"match": "\\b[-+]?[Hh][Ee][Xx]\\.[1-9a-fA-F][0-9a-fA-F]*(?:\\.(?:e|[0-9a-fA-F]+))?\\b"
				}
			]
		},
		"functions": {
			"patterns": [
				{
					"include": "#logical-functions"
				}
			]
		},
		"logical-functions": {
			"patterns": [
				{
					"comment": "I cannot find a perfect way to deal with this question up to now",
					"match": "[∀∃!](?![^:]*:)",
					"name": "function.logical.gm"
				}
			]
		},
		"keywords": {
			"patterns": [
				{
					"name": "delimiter.gm",
					"match": " |^\t+"
				},
				{
					"name": "punctuation.separator.gm",
					"match": ","
				},
				{
					"name": "keyword.control.flow.gm",
					"match": "(?:⇒|⇔|⇐)(?!:)"
				},
				{
					"name": "keyword.control.define.gm",
					"match": ":"
				}
			]
		},
		"invalids": {
			"patterns": [
				{
					"name": "invalid.illegal.define.gm",
					"match": "(?<=^|\\s|:):"
				},
				{
					"name": "invalid.illegal.quantifier.gm",
					"match": "\\w+[∀∃!]"
				},
				{
					"name": "invalid.deprecated.triple.gm",
					"match": "```",
					"comment": "it can be only used in the comments. In fact you can define it."
				},
				{
					"name": "invalid.deprecated.tab.gm",
					"match": "[^\t\n]\t+",
					"comment": "Tab should always at the start of new lines"
				}
			]
		},
		"strings": {
			"patterns": [
				{
					"include": "#line-strings"
				},
				{
					"include": "#pre-strings"
				}
			]
		},
		"comments": {
			"patterns": [
				{
					"include": "#block-comments"
				},
				{
					"include": "#line-comments"
				}
			]
		},
		"block-comments": {
			"begin": "(?<=^|[,({])\\s*(\\[)",
			"beginCaptures": {
				"1": {
					"name": "punctuation.comment.block.begin.gm"
				}
			},
			"end": "(\\])",
			"endCaptures": {
				"1": {
					"name": "punctuation.comment.block.end.gm"
				}
			},
			"name": "comment.block.gm",
			"patterns": [
				{
					"include": "#strings"
				},
				{
					"include": "#better-comments"
				},
				{
					"begin": "(?<!`)```(?!`)",
					"end": "(?<!`)```(?!`)",
					"name": "string.quoted.triple.gm",
					"patterns": [
						{
							"include": "#gmlang"
						},
						{
							"match": "````",
							"name": "invalid.illegal.gm"
						}
					]
				}
			]
		},
		"line-comments": {
			"begin": "(;)",
			"beginCaptures": {
				"1": {
					"name": "punctuation.comment.line.gm"
				}
			},
			"end": "\n",
			"name": "comment.line.gm",
			"patterns": [
				{
					"include": "#better-comments"
				}
			]
		},
		"better-comments": {
			"patterns": [
				{
					"match": "(?i)(?<=;|^)\\s*(?:\\+|todo).*?(?=$|\\s;)",
					"name": "comment.line.todo.gm"
				},
				{
					"match": "(?i)(?<=;|^)\\s*(?:\\*|note).*?(?=$|\\s;)",
					"name": "comment.line.note.gm"
				},
				{
					"match": "(?i)(?<=;|^)\\s*(?:\\?|wait).*?(?=$|\\s;)",
					"name": "comment.line.wait.gm",
					"comment": "I do not determined now"
				},
				{
					"match": "(?i)(?<=;|^)\\s*(?:\\!|warn).*?(?=$|\\s;)",
					"name": "comment.line.warn.gm"
				}
			]
		},
		"line-strings": {
			"comment": "copy from the python source file",
			"name": "string.quoted.line.gm",
			"begin": "\"",
			"beginCaptures": {
				"0": {
					"name": "punctuation.string.quoted.line.begin"
				}
			},
			"end": "\"|(?:(?<!\\\\)\n)",
			"endCaptures": {
				"0": {
					"name": "punctuation.string.quoted.line.end"
				}
			},
			"patterns": [
				{
					"name": "constant.character.escape.gm",
					"match": "\\\\."
				}
			]
		},
		"pre-strings": {
			"comment": "no escape_character in it, which means it cannot includes '`'",
			"name": "string.quoted.pre.gm",
			"begin": "`(?!``)",
			"beginCaptures": {
				"0": {
					"name": "punctuation.string.quoted.pre.begin"
				}
			},
			"end": "`(?!``)",
			"endCaptures": {
				"0": {
					"name": "punctuation.string.quoted.pre.end"
				}
			},
			"patterns": []
		}
	}
}